{"ast":null,"code":"import _objectSpread from\"D:/vendas/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{initializeApp}from'firebase/app';import{getAuth,signInAnonymously,signInWithCustomToken,onAuthStateChanged}from'firebase/auth';import{getFirestore,collection,addDoc,query,orderBy,onSnapshot,Timestamp}from'firebase/firestore';import{AreaChart,Area,XAxis,YAxis,CartesianGrid,Tooltip,Legend,ResponsiveContainer,LabelList// Import LabelList\n}from'recharts';// Componente SmartFix para notificações\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const SmartFix=_ref=>{let{message,type,onClose}=_ref;const[isVisible,setIsVisible]=useState(false);const timeoutRef=useRef(null);useEffect(()=>{if(message){setIsVisible(true);if(timeoutRef.current){clearTimeout(timeoutRef.current);}timeoutRef.current=setTimeout(()=>{setIsVisible(false);onClose();// Chama a função onClose do pai para limpar o estado da mensagem\n},5000);// A mensagem desaparece após 5 segundos\n}else{setIsVisible(false);}return()=>{if(timeoutRef.current){clearTimeout(timeoutRef.current);}};},[message,onClose]);if(!isVisible||!message)return null;let bgColorClass='';let borderColorClass='';let textColorClass='';switch(type){case'info':bgColorClass='bg-blue-100';borderColorClass='border-blue-400';textColorClass='text-blue-700';break;case'success':bgColorClass='bg-green-100';borderColorClass='border-green-400';textColorClass='text-green-700';break;case'error':bgColorClass='bg-red-100';borderColorClass='border-red-400';textColorClass='text-red-700';break;case'warning':bgColorClass='bg-yellow-100';borderColorClass='border-yellow-400';textColorClass='text-yellow-800';break;default:bgColorClass='bg-gray-100';borderColorClass='border-gray-400';textColorClass='text-gray-700';}return/*#__PURE__*/_jsxs(\"div\",{className:\"fixed top-4 right-4 p-4 rounded-lg shadow-lg flex items-center justify-between z-50 transition-all duration-500 transform \".concat(bgColorClass,\" \").concat(borderColorClass,\" \").concat(textColorClass,\" \").concat(isVisible?'translate-x-0 opacity-100':'translate-x-full opacity-0'),role:\"alert\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"block sm:inline\",children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsVisible(false),className:\"ml-4 text-current opacity-75 hover:opacity-100 focus:outline-none\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-4 w-4\",role:\"button\",xmlns:\"http://www.w3.org/2000/svg\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\",clipRule:\"evenodd\"})})})]});};function App(){const[db,setDb]=useState(null);const[auth,setAuth]=useState(null);const[userId,setUserId]=useState(null);const[sales,setSales]=useState([]);const[newSaleAmount,setNewSaleAmount]=useState('');const[loading,setLoading]=useState(true);// Estado do SmartFix\nconst[smartFixMessage,setSmartFixMessage]=useState('');const[smartFixType,setSmartFixType]=useState('info');// Novas variáveis de estado para navegação e adição de vendas passadas\nconst[viewMode,setViewMode]=useState('daily');// 'daily', 'weekly', 'monthly', 'yearly'\nconst[displayDate,setDisplayDate]=useState(new Date());// Para a visualização diária\nconst[displayMonth,setDisplayMonth]=useState(new Date().getMonth());// Para a visualização mensal\nconst[displayYear,setDisplayYear]=useState(new Date().getFullYear());// Para a visualização mensal e anual\nconst[displayWeek,setDisplayWeek]=useState(getWeekNumber(new Date()));// Para a visualização semanal\nconst[selectedSaleDate,setSelectedSaleDate]=useState(new Date().toISOString().split('T')[0]);const saleInputRef=useRef(null);// Estado relacionado ao PWA para o prompt \"Adicionar à Tela Inicial\"\nconst[deferredPrompt,setDeferredPrompt]=useState(null);const[showInstallMessage,setShowInstallMessage]=useState(false);// Função auxiliar para obter o número da semana (padrão de data da semana ISO)\nfunction getWeekNumber(d){d=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));d.setUTCDate(d.getUTCDate()+4-(d.getUTCDay()||7));// Define para a quinta-feira mais próxima: data atual + 4 - número do dia atual (0-6)\nconst yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));const weekNo=Math.ceil(((d-yearStart)/86400000+1)/7);return weekNo;}// Função auxiliar para obter o início da semana (domingo)\nconst getStartOfWeek=date=>{const d=new Date(date);const day=d.getDay();// 0 para domingo, 6 para sábado\nconst diff=d.getDate()-day;// Ajusta a data para o domingo da semana atual\nreturn new Date(d.getFullYear(),d.getMonth(),diff,0,0,0,0);};// Função auxiliar para obter o fim da semana (sábado)\nconst getEndOfWeek=date=>{const d=new Date(date);const day=d.getDay();// 0 para domingo, 6 para sábado\nconst diff=d.getDate()+(6-day);// Ajusta a data para o sábado da semana atual\nreturn new Date(d.getFullYear(),d.getMonth(),diff,23,59,59,999);};// Função para exibir a mensagem SmartFix\nconst showSmartFix=function(msg){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'info';setSmartFixMessage(msg);setSmartFixType(type);};// Inicializa o Firebase e configura a autenticação\nuseEffect(()=>{try{const firebaseConfig=typeof __firebase_config!=='undefined'?JSON.parse(__firebase_config):{};const app=initializeApp(firebaseConfig);const firestore=getFirestore(app);const firebaseAuth=getAuth(app);setDb(firestore);setAuth(firebaseAuth);onAuthStateChanged(firebaseAuth,async user=>{if(user){setUserId(user.uid);showSmartFix(\"Bem-vindo, utilizador \".concat(user.uid.substring(0,8),\"...\"),'info');}else{try{if(typeof __initial_auth_token!=='undefined'){await signInWithCustomToken(firebaseAuth,__initial_auth_token);}else{await signInAnonymously(firebaseAuth);}}catch(signInError){console.error(\"Erro ao iniciar sessão no Firebase:\",signInError);showSmartFix(\"Não foi possível autenticar. Tente novamente mais tarde.\",'error');}finally{setLoading(false);}}});}catch(err){console.error(\"Erro ao inicializar Firebase:\",err);showSmartFix(\"Erro ao carregar a aplicação. Verifique a sua configuração do Firebase.\",'error');setLoading(false);}},[]);// Busca os dados de vendas quando userId e db estão disponíveis\nuseEffect(()=>{if(db&&userId){setLoading(true);setSmartFixMessage('');// Limpa mensagens anteriores\ntry{const salesCollectionRef=collection(db,\"artifacts/\".concat(typeof __app_id!=='undefined'?__app_id:'default-app-id',\"/users/\").concat(userId,\"/dailySales\"));// Ordena por timestamp para obter as vendas mais recentes pela sua data real\nconst q=query(salesCollectionRef,orderBy('timestamp','asc'));// Ordena em ordem crescente para exibição do gráfico\nconst unsubscribe=onSnapshot(q,snapshot=>{const salesData=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setSales(salesData);setLoading(false);},err=>{console.error(\"Erro ao carregar vendas:\",err);showSmartFix(\"Não foi possível carregar as vendas. Tente recarregar a página.\",'error');setLoading(false);});return()=>unsubscribe();// Limpa a subscrição ao desmontar\n}catch(err){console.error(\"Erro ao configurar o listener de vendas:\",err);showSmartFix(\"Erro ao aceder dados de vendas.\",'error');setLoading(false);}}},[db,userId]);// PWA: Ouve o evento beforeinstallprompt\nuseEffect(()=>{const handleBeforeInstallPrompt=e=>{e.preventDefault();// Impede que a mini-barra de informações apareça no telemóvel\nsetDeferredPrompt(e);// Apenas mostra a mensagem de instalação personalizada se o prompt estiver disponível\nsetShowInstallMessage(true);console.log('beforeinstallprompt event fired');};window.addEventListener('beforeinstallprompt',handleBeforeInstallPrompt);return()=>{window.removeEventListener('beforeinstallprompt',handleBeforeInstallPrompt);};},[]);// PWA: Lida com o clique de instalação\nconst handleInstallClick=async()=>{if(!deferredPrompt){// Mensagem para iOS ou quando o prompt não está disponível\nshowSmartFix(\"Para instalar a aplicação, use o menu 'Partilhar' do seu navegador e selecione 'Adicionar ao Ecrã Principal'.\",'info');return;}// Mostra o prompt de instalação nativo\ndeferredPrompt.prompt();// Espera que o utilizador responda ao prompt\nconst{outcome}=await deferredPrompt.userChoice;console.log(\"Resposta do utilizador ao prompt de instala\\xE7\\xE3o: \".concat(outcome));// Não precisamos mais do prompt, oculta a mensagem personalizada\nsetDeferredPrompt(null);setShowInstallMessage(false);if(outcome==='accepted'){showSmartFix('Aplicação instalada com sucesso!','success');}else{showSmartFix('Instalação cancelada.','info');}};// Função para adicionar uma nova venda\nconst handleAddSale=async()=>{if(newSaleAmount===''||isNaN(parseFloat(newSaleAmount))){showSmartFix('Por favor, insira um valor de venda válido.','warning');return;}if(!db||!userId){showSmartFix('Aplicação não pronta ou utilizador não autenticado. Tente novamente.','error');return;}setLoading(true);setSmartFixMessage('');// Limpa mensagens anteriores\ntry{const amount=parseFloat(newSaleAmount);// Cria um objeto Date a partir da string selectedSaleDate para o timestamp\nconst saleDateTime=new Date(selectedSaleDate+'T12:00:00');// Adiciona T12:00:00 para evitar problemas de fuso horário à meia-noite\nconst salesCollectionRef=collection(db,\"artifacts/\".concat(typeof __app_id!=='undefined'?__app_id:'default-app-id',\"/users/\").concat(userId,\"/dailySales\"));await addDoc(salesCollectionRef,{amount:amount,timestamp:Timestamp.fromDate(saleDateTime),// Armazena como Timestamp do Firestore\ndate:selectedSaleDate// Armazena a data como string AAAA-MM-DD\n});setNewSaleAmount('');// Atualiza displayDate e viewMode para mostrar o dia da venda recém-adicionada\nsetDisplayDate(new Date(selectedSaleDate));// Define a data de exibição para a data da nova venda\nsetDisplayMonth(new Date(selectedSaleDate).getMonth());// Também atualiza o mês de exibição\nsetDisplayYear(new Date(selectedSaleDate).getFullYear());// Também atualiza o ano de exibição\nsetViewMode('daily');// Garante que a visualização mude para diária para ver a venda específica\nsetSelectedSaleDate(new Date().toISOString().split('T')[0]);// Redefine o seletor de data para a entrada seguinte\nshowSmartFix('Venda adicionada com sucesso!','success');if(saleInputRef.current){saleInputRef.current.focus();}}catch(e){console.error(\"Erro ao adicionar documento: \",e);showSmartFix(\"Erro ao adicionar venda. Por favor, tente novamente.\",'error');}finally{setLoading(false);}};// Função auxiliar para formatar a moeda\nconst formatCurrency=amount=>{return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(amount);};// Filtra as vendas com base no modo de visualização e navegação\nconst getFilteredSales=()=>{return sales.filter(sale=>{// Para comparação diária, usa a string 'date' armazenada diretamente para robustez\n// Para outros períodos, converte o timestamp para Date e normaliza\nconst saleDate=sale.timestamp?new Date(sale.timestamp.toDate()):new Date(sale.date);saleDate.setHours(0,0,0,0);// Normaliza a data da venda para o início do dia\nswitch(viewMode){case'daily':// Compara diretamente usando a string AAAA-MM-DD\nconst currentDayString=new Date(displayDate).toISOString().split('T')[0];return sale.date===currentDayString;case'weekly':const startOfWeek=getStartOfWeek(displayDate);const endOfWeek=getEndOfWeek(displayDate);return saleDate>=startOfWeek&&saleDate<=endOfWeek;case'monthly':return saleDate.getMonth()===displayMonth&&saleDate.getFullYear()===displayYear;case'yearly':return saleDate.getFullYear()===displayYear;default:return true;}});};const filteredSales=getFilteredSales();const currentPeriodTotal=filteredSales.reduce((sum,sale)=>sum+sale.amount,0);// Prepara os dados para o gráfico com base no viewMode\nconst getChartData=()=>{const aggregatedData={};filteredSales.forEach(sale=>{const saleDate=sale.timestamp?new Date(sale.timestamp.toDate()):new Date(sale.date);let key;// Chave para agregação (ex: 'AAAA-MM-DD', 'AAAA-Sx', 'AAAA-MM')\nlet label;// Rótulo para o eixo X (ex: 'Jan 01', 'Semana 1', 'Janeiro')\nswitch(viewMode){case'daily':key=sale.date;// AAAA-MM-DD\nlabel=new Date(sale.date).toLocaleDateString('pt-BR',{day:'2-digit',month:'short'});break;case'weekly':const weekNumber=getWeekNumber(saleDate);key=\"\".concat(saleDate.getFullYear(),\"-W\").concat(weekNumber);label=\"Semana \".concat(weekNumber);break;case'monthly':// Agrega por número da semana dentro do mês, e cria rótulos de intervalo de datas\nconst monthWeekNumber=getWeekNumber(saleDate);const startOfPeriodWeek=getStartOfWeek(saleDate);const endOfPeriodWeek=getEndOfWeek(saleDate);// Garante que as datas de início/fim da semana estejam dentro do mês de exibição atual\nconst monthStart=new Date(displayYear,displayMonth,1);const monthEnd=new Date(displayYear,displayMonth+1,0,23,59,59,999);let displayStart=startOfPeriodWeek;let displayEnd=endOfPeriodWeek;// Ajusta o início/fim da semana para estar dentro dos limites do mês\nif(startOfPeriodWeek<monthStart){displayStart=monthStart;}if(endOfPeriodWeek>monthEnd){displayEnd=monthEnd;}key=\"\".concat(saleDate.getFullYear(),\"-\").concat(saleDate.getMonth()+1,\"-W\").concat(monthWeekNumber);label=\"\".concat(displayStart.toLocaleDateString('pt-BR',{day:'2-digit'}),\" - \").concat(displayEnd.toLocaleDateString('pt-BR',{day:'2-digit'}));break;case'yearly':const month=saleDate.getMonth();const year=saleDate.getFullYear();key=\"\".concat(year,\"-\").concat(month);// Agrega por mês\nlabel=new Date(year,month,1).toLocaleDateString('pt-BR',{month:'long'});break;default:key=sale.date;label=sale.date;}if(aggregatedData[key]){aggregatedData[key].total+=sale.amount;}else{aggregatedData[key]={key:key,// Armazena a chave para ordenação\nlabel:label,total:sale.amount,date:saleDate// Armazena a data original para ordenação em visualizações anuais/semanais\n};}});// Converte para array e ordena\nconst data=Object.values(aggregatedData).sort((a,b)=>{// Ordena com base no objeto Date real, se disponível, caso contrário pela chave\nif(a.date&&b.date){return a.date-b.date;}return a.key.localeCompare(b.key);});return data;};const chartData=getChartData();// Componente de Rótulo Personalizado para os picos do AreaChart\nconst CustomLabel=props=>{const{x,y,stroke,value}=props;// Apenas exibe o rótulo se o valor não for zero para evitar desordem em períodos vazios\n// dy = -8 move o rótulo ligeiramente acima do ponto.\n// fill é a cor do texto do rótulo.\n// textAnchor=\"middle\" centraliza o texto.\nif(value>0){return/*#__PURE__*/_jsx(\"text\",{x:x,y:y,dy:-8,fill:\"#20B2AA\",fontSize:12,textAnchor:\"middle\",fontWeight:\"bold\",children:formatCurrency(value)});}return null;};// Lida com a navegação para diferentes períodos\nconst handleNavigate=direction=>{let newDate=new Date(displayDate);let newMonth=displayMonth;let newYear=displayYear;switch(viewMode){case'daily':newDate.setDate(displayDate.getDate()+direction);setDisplayDate(newDate);break;case'weekly':newDate.setDate(displayDate.getDate()+direction*7);// Move por 7 dias para uma semana\nsetDisplayDate(newDate);setDisplayWeek(getWeekNumber(newDate));break;case'monthly':newMonth+=direction;if(newMonth>11){newMonth=0;newYear++;}else if(newMonth<0){newMonth=11;newYear--;}setDisplayMonth(newMonth);setDisplayYear(newYear);// Ajusta displayDate para estar dentro do novo mês para consistência\nsetDisplayDate(new Date(newYear,newMonth,1));break;case'yearly':newYear+=direction;setDisplayYear(newYear);// Ajusta displayDate para estar dentro do novo ano para consistência\nsetDisplayDate(new Date(newYear,0,1));break;default:break;}};// Formata a string do período para exibição\nconst formatDisplayPeriod=()=>{const options={year:'numeric',month:'long',day:'numeric'};const date=new Date(displayDate);// Usa displayDate para o contexto de exibição diária/semanal\ndate.setFullYear(displayYear,displayMonth,1);// Para o contexto mensal/anual\nswitch(viewMode){case'daily':return\"Dia: \".concat(new Date(displayDate).toLocaleDateString('pt-BR',options));case'weekly':const startOfWeek=getStartOfWeek(displayDate).toLocaleDateString('pt-BR');const endOfWeek=getEndOfWeek(displayDate).toLocaleDateString('pt-BR');return\"Semana: \".concat(startOfWeek,\" - \").concat(endOfWeek,\" (Semana \").concat(getWeekNumber(displayDate),\")\");case'monthly':return\"M\\xEAs: \".concat(new Date(displayYear,displayMonth,1).toLocaleDateString('pt-BR',{year:'numeric',month:'long'}));case'yearly':return\"Ano: \".concat(displayYear);default:return'';}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center p-4 font-sans text-gray-800\",children:[/*#__PURE__*/_jsx(SmartFix,{message:smartFixMessage,type:smartFixType,onClose:()=>setSmartFixMessage('')}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-8 rounded-xl shadow-2xl w-full max-w-4xl backdrop-filter backdrop-blur-sm bg-opacity-90 border border-purple-300\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-4xl font-extrabold text-center text-purple-800 mb-8 tracking-tight\",children:\"\\uD83D\\uDCB8 Minhas Vendas \\uD83D\\uDCB8\"}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-center items-center h-32\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-500\"}),/*#__PURE__*/_jsx(\"p\",{className:\"ml-4 text-purple-700 text-lg\",children:\"A carregar dados...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[showInstallMessage&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-3 rounded relative mb-4 flex items-center justify-between\",role:\"alert\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Quer instalar esta aplica\\xE7\\xE3o para acesso r\\xE1pido?\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleInstallClick,className:\"ml-4 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 active:scale-95\",children:\"Instalar Aplica\\xE7\\xE3o\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8 p-6 bg-purple-50 rounded-lg shadow-inner border border-purple-200\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold text-purple-700 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 mr-2 text-purple-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.592 1M12 8V7m0 1v8m0 4v1m-6-10H4m4-2H6m7 0h4m-4 2h2M6 20H4m2-2h2m0-6h2m-2 4h2m-2-6h-2m2 0H8m6 0h2m-2 2h2m-2 0H8\"})}),\"Registar Nova Venda\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row gap-4 mb-4\",children:[/*#__PURE__*/_jsx(\"input\",{ref:saleInputRef,type:\"number\",step:\"0.01\",className:\"flex-grow p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-500 focus:border-transparent text-lg shadow-sm\",placeholder:\"Ex: 50.75\",value:newSaleAmount,onChange:e=>setNewSaleAmount(e.target.value),onKeyPress:e=>{if(e.key==='Enter'){handleAddSale();}}}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-500 focus:border-transparent text-lg shadow-sm\",value:selectedSaleDate,onChange:e=>setSelectedSaleDate(e.target.value)})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleAddSale,className:\"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 active:scale-95 flex items-center justify-center text-lg\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 mr-2\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z\"})}),\"Adicionar Venda\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 flex justify-center space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setViewMode('daily');setDisplayDate(new Date());// Redefine para hoje\n},className:\"py-2 px-5 rounded-lg font-semibold transition duration-200 \".concat(viewMode==='daily'?'bg-purple-700 text-white shadow-md':'bg-gray-200 text-gray-700 hover:bg-gray-300'),children:\"Dia\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setViewMode('weekly');setDisplayDate(new Date());// Redefine para a semana atual\n},className:\"py-2 px-5 rounded-lg font-semibold transition duration-200 \".concat(viewMode==='weekly'?'bg-purple-700 text-white shadow-md':'bg-gray-200 text-gray-700 hover:bg-gray-300'),children:\"Semana\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setViewMode('monthly');setDisplayMonth(new Date().getMonth());// Redefine para o mês atual\nsetDisplayYear(new Date().getFullYear());// Redefine para o ano atual\n},className:\"py-2 px-5 rounded-lg font-semibold transition duration-200 \".concat(viewMode==='monthly'?'bg-purple-700 text-white shadow-md':'bg-gray-200 text-gray-700 hover:bg-gray-300'),children:\"M\\xEAs\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setViewMode('yearly');setDisplayYear(new Date().getFullYear());// Redefine para o ano atual\n},className:\"py-2 px-5 rounded-lg font-semibold transition duration-200 \".concat(viewMode==='yearly'?'bg-purple-700 text-white shadow-md':'bg-gray-200 text-gray-700 hover:bg-gray-300'),children:\"Ano\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8 flex items-center justify-between p-4 bg-purple-100 rounded-lg shadow-inner border border-purple-200\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleNavigate(-1),className:\"p-2 rounded-full bg-purple-300 text-purple-800 hover:bg-purple-400 transition duration-200\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M15 19l-7-7 7-7\"})})}),/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-bold text-purple-800 text-center flex-grow\",children:[\"Vendas de: \",formatDisplayPeriod()]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleNavigate(1),className:\"p-2 rounded-full bg-purple-300 text-purple-800 hover:bg-purple-400 transition duration-200\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M9 5l7 7-7 7\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-purple-100 p-6 rounded-xl shadow-lg border border-purple-300 mb-8\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-xl font-semibold text-purple-700 mb-3 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 mr-2 text-purple-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M11 4a2 2 0 114 0v12a4 4 0 11-8 0V4a2 2 0 114 0v12a4 4 0 11-8 0\"})}),\"Total do Per\\xEDodo\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-4xl font-bold text-purple-900\",children:formatCurrency(currentPeriodTotal)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-purple-300 mb-8\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold text-purple-700 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 mr-2 text-purple-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M7 12l3-3 3 3 4-4M18 14H5a2 2 0 00-2 2v2a2 2 0 002 2h14a2 2 0 002-2v-2a2 2 0 00-2-2z\"})}),\"An\\xE1lise Visual de Vendas\"]}),chartData.length>0?/*#__PURE__*/_jsx(ResponsiveContainer,{width:\"100%\",height:300,children:/*#__PURE__*/_jsxs(AreaChart,{data:chartData,margin:{top:30,right:30,left:20,bottom:5},children:[\" \",/*#__PURE__*/_jsx(\"defs\",{children:/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"colorTotal\",x1:\"0\",y1:\"0\",x2:\"0\",y2:\"1\",children:[/*#__PURE__*/_jsx(\"stop\",{offset:\"5%\",stopColor:\"#20B2AA\",stopOpacity:0.8}),\" \",/*#__PURE__*/_jsx(\"stop\",{offset:\"95%\",stopColor:\"#20B2AA\",stopOpacity:0})]})}),/*#__PURE__*/_jsx(CartesianGrid,{strokeDasharray:\"3 3\",stroke:\"#e0e0e0\"}),/*#__PURE__*/_jsx(XAxis,{dataKey:\"label\"// Usa 'label' para exibição do eixo X\n,style:{fontSize:'0.75rem'}// Fonte menor para rótulos\n}),/*#__PURE__*/_jsx(YAxis,{tickFormatter:tick=>formatCurrency(tick),style:{fontSize:'0.75rem'}}),/*#__PURE__*/_jsx(Tooltip,{formatter:(value,name)=>\"\".concat(name,\": \").concat(formatCurrency(value))// Formata o valor e mostra o nome da série\n,labelFormatter:(label,payload)=>{var _payload$;// Encontra o ponto de dados correspondente para obter a data/período real\nconst dataPoint=(_payload$=payload[0])===null||_payload$===void 0?void 0:_payload$.payload;if(!dataPoint)return label;switch(viewMode){case'daily':return\"Vendas em \".concat(new Date(dataPoint.key).toLocaleDateString('pt-BR',{weekday:'short',year:'numeric',month:'short',day:'numeric'}));case'weekly':return\"Vendas da \".concat(dataPoint.label,\" de \").concat(new Date(dataPoint.date).getFullYear());case'monthly':// Rótulo da dica de ferramenta ajustado para a visualização mensal para mostrar informações da semana\nconst weekStartDate=getStartOfWeek(new Date(dataPoint.date));// Usa dataPoint.date\nconst weekEndDate=getEndOfWeek(new Date(dataPoint.date));// Usa dataPoint.date\nreturn\"Vendas da \".concat(dataPoint.label,\" (\").concat(weekStartDate.toLocaleDateString('pt-BR'),\" - \").concat(weekEndDate.toLocaleDateString('pt-BR'),\") de \").concat(new Date(displayYear,displayMonth,1).toLocaleDateString('pt-BR',{month:'long',year:'numeric'}));case'yearly':return\"Vendas de \".concat(dataPoint.label,\" de \").concat(dataPoint.key.split('-')[0]);default:return label;}}}),/*#__PURE__*/_jsx(Legend,{}),/*#__PURE__*/_jsxs(Area,{type:\"monotone\",dataKey:\"total\"// Vendas reais\n,stroke:\"#20B2AA\"// Traço mais claro para vendas reais\n,fillOpacity:1,fill:\"url(#colorTotal)\",activeDot:{r:8},name:viewMode==='monthly'?'Vendas Semanais no Mês':'Vendas Mensais no Ano'// Nome dinâmico com base no viewMode\n,children:[/*#__PURE__*/_jsx(LabelList,{dataKey:\"total\",content:/*#__PURE__*/_jsx(CustomLabel,{})}),\" \"]})]})}):/*#__PURE__*/_jsx(\"p\",{className:\"text-purple-600 italic text-center\",children:\"Adicione vendas para visualizar o gr\\xE1fico.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-purple-300\",children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold text-purple-700 mb-4 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 mr-2 text-purple-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\"})}),\"Vendas Detalhadas\"]}),filteredSales.length>0?/*#__PURE__*/_jsx(\"ul\",{className:\"divide-y divide-purple-200\",children:filteredSales.map(sale=>/*#__PURE__*/_jsxs(\"li\",{className:\"py-3 flex justify-between items-center text-purple-800\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-lg\",children:sale.timestamp?new Date(sale.timestamp.toDate()).toLocaleString('pt-BR'):'Data Indisponível'}),/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold text-xl\",children:formatCurrency(sale.amount)})]},sale.id))}):/*#__PURE__*/_jsx(\"p\",{className:\"text-purple-600 italic\",children:\"Nenhuma venda registada para este per\\xEDodo.\"})]}),userId&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-center text-gray-500 mt-6\",children:[\"ID do Utilizador: \",userId]})]})]})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","useRef","initializeApp","getAuth","signInAnonymously","signInWithCustomToken","onAuthStateChanged","getFirestore","collection","addDoc","query","orderBy","onSnapshot","Timestamp","AreaChart","Area","XAxis","YAxis","CartesianGrid","Tooltip","Legend","ResponsiveContainer","LabelList","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SmartFix","_ref","message","type","onClose","isVisible","setIsVisible","timeoutRef","current","clearTimeout","setTimeout","bgColorClass","borderColorClass","textColorClass","className","concat","role","children","onClick","xmlns","viewBox","fill","fillRule","d","clipRule","App","db","setDb","auth","setAuth","userId","setUserId","sales","setSales","newSaleAmount","setNewSaleAmount","loading","setLoading","smartFixMessage","setSmartFixMessage","smartFixType","setSmartFixType","viewMode","setViewMode","displayDate","setDisplayDate","Date","displayMonth","setDisplayMonth","getMonth","displayYear","setDisplayYear","getFullYear","displayWeek","setDisplayWeek","getWeekNumber","selectedSaleDate","setSelectedSaleDate","toISOString","split","saleInputRef","deferredPrompt","setDeferredPrompt","showInstallMessage","setShowInstallMessage","UTC","getDate","setUTCDate","getUTCDate","getUTCDay","yearStart","getUTCFullYear","weekNo","Math","ceil","getStartOfWeek","date","day","getDay","diff","getEndOfWeek","showSmartFix","msg","arguments","length","undefined","firebaseConfig","__firebase_config","JSON","parse","app","firestore","firebaseAuth","user","uid","substring","__initial_auth_token","signInError","console","error","err","salesCollectionRef","__app_id","q","unsubscribe","snapshot","salesData","docs","map","doc","_objectSpread","id","data","handleBeforeInstallPrompt","e","preventDefault","log","window","addEventListener","removeEventListener","handleInstallClick","prompt","outcome","userChoice","handleAddSale","isNaN","parseFloat","amount","saleDateTime","timestamp","fromDate","focus","formatCurrency","Intl","NumberFormat","style","currency","format","getFilteredSales","filter","sale","saleDate","toDate","setHours","currentDayString","startOfWeek","endOfWeek","filteredSales","currentPeriodTotal","reduce","sum","getChartData","aggregatedData","forEach","key","label","toLocaleDateString","month","weekNumber","monthWeekNumber","startOfPeriodWeek","endOfPeriodWeek","monthStart","monthEnd","displayStart","displayEnd","year","total","Object","values","sort","a","b","localeCompare","chartData","CustomLabel","props","x","y","stroke","value","dy","fontSize","textAnchor","fontWeight","handleNavigate","direction","newDate","newMonth","newYear","setDate","formatDisplayPeriod","options","setFullYear","strokeLinecap","strokeLinejoin","strokeWidth","ref","step","placeholder","onChange","target","onKeyPress","width","height","margin","top","right","left","bottom","x1","y1","x2","y2","offset","stopColor","stopOpacity","strokeDasharray","dataKey","tickFormatter","tick","formatter","name","labelFormatter","payload","_payload$","dataPoint","weekday","weekStartDate","weekEndDate","fillOpacity","activeDot","r","content","toLocaleString"],"sources":["D:/vendas/src/App.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { initializeApp } from 'firebase/app';\r\nimport { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';\r\nimport { getFirestore, collection, addDoc, query, orderBy, onSnapshot, Timestamp } from 'firebase/firestore';\r\nimport {\r\n  AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LabelList // Import LabelList\r\n} from 'recharts';\r\n\r\n// Componente SmartFix para notificações\r\nconst SmartFix = ({ message, type, onClose }) => {\r\n  const [isVisible, setIsVisible] = useState(false);\r\n  const timeoutRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (message) {\r\n      setIsVisible(true);\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n      timeoutRef.current = setTimeout(() => {\r\n        setIsVisible(false);\r\n        onClose(); // Chama a função onClose do pai para limpar o estado da mensagem\r\n      }, 5000); // A mensagem desaparece após 5 segundos\r\n    } else {\r\n      setIsVisible(false);\r\n    }\r\n\r\n    return () => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n    };\r\n  }, [message, onClose]);\r\n\r\n  if (!isVisible || !message) return null;\r\n\r\n  let bgColorClass = '';\r\n  let borderColorClass = '';\r\n  let textColorClass = '';\r\n\r\n  switch (type) {\r\n    case 'info':\r\n      bgColorClass = 'bg-blue-100';\r\n      borderColorClass = 'border-blue-400';\r\n      textColorClass = 'text-blue-700';\r\n      break;\r\n    case 'success':\r\n      bgColorClass = 'bg-green-100';\r\n      borderColorClass = 'border-green-400';\r\n      textColorClass = 'text-green-700';\r\n      break;\r\n    case 'error':\r\n      bgColorClass = 'bg-red-100';\r\n      borderColorClass = 'border-red-400';\r\n      textColorClass = 'text-red-700';\r\n      break;\r\n    case 'warning':\r\n      bgColorClass = 'bg-yellow-100';\r\n      borderColorClass = 'border-yellow-400';\r\n      textColorClass = 'text-yellow-800';\r\n      break;\r\n    default:\r\n      bgColorClass = 'bg-gray-100';\r\n      borderColorClass = 'border-gray-400';\r\n      textColorClass = 'text-gray-700';\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className={`fixed top-4 right-4 p-4 rounded-lg shadow-lg flex items-center justify-between z-50 transition-all duration-500 transform ${bgColorClass} ${borderColorClass} ${textColorClass} ${isVisible ? 'translate-x-0 opacity-100' : 'translate-x-full opacity-0'}`}\r\n      role=\"alert\"\r\n    >\r\n      <span className=\"block sm:inline\">{message}</span>\r\n      <button onClick={() => setIsVisible(false)} className=\"ml-4 text-current opacity-75 hover:opacity-100 focus:outline-none\">\r\n        <svg className=\"h-4 w-4\" role=\"button\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n          <path fillRule=\"evenodd\" d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\" clipRule=\"evenodd\" />\r\n        </svg>\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\nfunction App() {\r\n  const [db, setDb] = useState(null);\r\n  const [auth, setAuth] = useState(null);\r\n  const [userId, setUserId] = useState(null);\r\n  const [sales, setSales] = useState([]);\r\n  const [newSaleAmount, setNewSaleAmount] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Estado do SmartFix\r\n  const [smartFixMessage, setSmartFixMessage] = useState('');\r\n  const [smartFixType, setSmartFixType] = useState('info');\r\n\r\n  // Novas variáveis de estado para navegação e adição de vendas passadas\r\n  const [viewMode, setViewMode] = useState('daily'); // 'daily', 'weekly', 'monthly', 'yearly'\r\n  const [displayDate, setDisplayDate] = useState(new Date()); // Para a visualização diária\r\n  const [displayMonth, setDisplayMonth] = useState(new Date().getMonth()); // Para a visualização mensal\r\n  const [displayYear, setDisplayYear] = useState(new Date().getFullYear()); // Para a visualização mensal e anual\r\n  const [displayWeek, setDisplayWeek] = useState(getWeekNumber(new Date())); // Para a visualização semanal\r\n\r\n  const [selectedSaleDate, setSelectedSaleDate] = useState(new Date().toISOString().split('T')[0]);\r\n\r\n  const saleInputRef = useRef(null);\r\n\r\n  // Estado relacionado ao PWA para o prompt \"Adicionar à Tela Inicial\"\r\n  const [deferredPrompt, setDeferredPrompt] = useState(null);\r\n  const [showInstallMessage, setShowInstallMessage] = useState(false);\r\n\r\n  // Função auxiliar para obter o número da semana (padrão de data da semana ISO)\r\n  function getWeekNumber(d) {\r\n    d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));\r\n    d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7)); // Define para a quinta-feira mais próxima: data atual + 4 - número do dia atual (0-6)\r\n    const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\r\n    const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);\r\n    return weekNo;\r\n  }\r\n\r\n  // Função auxiliar para obter o início da semana (domingo)\r\n  const getStartOfWeek = (date) => {\r\n    const d = new Date(date);\r\n    const day = d.getDay(); // 0 para domingo, 6 para sábado\r\n    const diff = d.getDate() - day; // Ajusta a data para o domingo da semana atual\r\n    return new Date(d.getFullYear(), d.getMonth(), diff, 0, 0, 0, 0);\r\n  };\r\n\r\n  // Função auxiliar para obter o fim da semana (sábado)\r\n  const getEndOfWeek = (date) => {\r\n    const d = new Date(date);\r\n    const day = d.getDay(); // 0 para domingo, 6 para sábado\r\n    const diff = d.getDate() + (6 - day); // Ajusta a data para o sábado da semana atual\r\n    return new Date(d.getFullYear(), d.getMonth(), diff, 23, 59, 59, 999);\r\n  };\r\n\r\n  // Função para exibir a mensagem SmartFix\r\n  const showSmartFix = (msg, type = 'info') => {\r\n    setSmartFixMessage(msg);\r\n    setSmartFixType(type);\r\n  };\r\n\r\n  // Inicializa o Firebase e configura a autenticação\r\n  useEffect(() => {\r\n    try {\r\n      const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};\r\n      const app = initializeApp(firebaseConfig);\r\n      const firestore = getFirestore(app);\r\n      const firebaseAuth = getAuth(app);\r\n\r\n      setDb(firestore);\r\n      setAuth(firebaseAuth);\r\n\r\n      onAuthStateChanged(firebaseAuth, async (user) => {\r\n        if (user) {\r\n          setUserId(user.uid);\r\n          showSmartFix(`Bem-vindo, utilizador ${user.uid.substring(0, 8)}...`, 'info');\r\n        } else {\r\n          try {\r\n            if (typeof __initial_auth_token !== 'undefined') {\r\n              await signInWithCustomToken(firebaseAuth, __initial_auth_token);\r\n            } else {\r\n              await signInAnonymously(firebaseAuth);\r\n            }\r\n          } catch (signInError) {\r\n            console.error(\"Erro ao iniciar sessão no Firebase:\", signInError);\r\n            showSmartFix(\"Não foi possível autenticar. Tente novamente mais tarde.\", 'error');\r\n          } finally {\r\n            setLoading(false);\r\n          }\r\n        }\r\n      });\r\n    } catch (err) {\r\n      console.error(\"Erro ao inicializar Firebase:\", err);\r\n      showSmartFix(\"Erro ao carregar a aplicação. Verifique a sua configuração do Firebase.\", 'error');\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  // Busca os dados de vendas quando userId e db estão disponíveis\r\n  useEffect(() => {\r\n    if (db && userId) {\r\n      setLoading(true);\r\n      setSmartFixMessage(''); // Limpa mensagens anteriores\r\n      try {\r\n        const salesCollectionRef = collection(db, `artifacts/${typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'}/users/${userId}/dailySales`);\r\n        // Ordena por timestamp para obter as vendas mais recentes pela sua data real\r\n        const q = query(salesCollectionRef, orderBy('timestamp', 'asc')); // Ordena em ordem crescente para exibição do gráfico\r\n\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n          const salesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n          setSales(salesData);\r\n          setLoading(false);\r\n        }, (err) => {\r\n          console.error(\"Erro ao carregar vendas:\", err);\r\n          showSmartFix(\"Não foi possível carregar as vendas. Tente recarregar a página.\", 'error');\r\n          setLoading(false);\r\n        });\r\n\r\n        return () => unsubscribe(); // Limpa a subscrição ao desmontar\r\n      } catch (err) {\r\n        console.error(\"Erro ao configurar o listener de vendas:\", err);\r\n        showSmartFix(\"Erro ao aceder dados de vendas.\", 'error');\r\n        setLoading(false);\r\n      }\r\n    }\r\n  }, [db, userId]);\r\n\r\n  // PWA: Ouve o evento beforeinstallprompt\r\n  useEffect(() => {\r\n    const handleBeforeInstallPrompt = (e) => {\r\n      e.preventDefault(); // Impede que a mini-barra de informações apareça no telemóvel\r\n      setDeferredPrompt(e);\r\n      // Apenas mostra a mensagem de instalação personalizada se o prompt estiver disponível\r\n      setShowInstallMessage(true);\r\n      console.log('beforeinstallprompt event fired');\r\n    };\r\n\r\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n\r\n    return () => {\r\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n    };\r\n  }, []);\r\n\r\n  // PWA: Lida com o clique de instalação\r\n  const handleInstallClick = async () => {\r\n    if (!deferredPrompt) {\r\n      // Mensagem para iOS ou quando o prompt não está disponível\r\n      showSmartFix(\"Para instalar a aplicação, use o menu 'Partilhar' do seu navegador e selecione 'Adicionar ao Ecrã Principal'.\", 'info');\r\n      return;\r\n    }\r\n\r\n    // Mostra o prompt de instalação nativo\r\n    deferredPrompt.prompt();\r\n\r\n    // Espera que o utilizador responda ao prompt\r\n    const { outcome } = await deferredPrompt.userChoice;\r\n    console.log(`Resposta do utilizador ao prompt de instalação: ${outcome}`);\r\n\r\n    // Não precisamos mais do prompt, oculta a mensagem personalizada\r\n    setDeferredPrompt(null);\r\n    setShowInstallMessage(false);\r\n\r\n    if (outcome === 'accepted') {\r\n      showSmartFix('Aplicação instalada com sucesso!', 'success');\r\n    } else {\r\n      showSmartFix('Instalação cancelada.', 'info');\r\n    }\r\n  };\r\n\r\n\r\n  // Função para adicionar uma nova venda\r\n  const handleAddSale = async () => {\r\n    if (newSaleAmount === '' || isNaN(parseFloat(newSaleAmount))) {\r\n      showSmartFix('Por favor, insira um valor de venda válido.', 'warning');\r\n      return;\r\n    }\r\n\r\n    if (!db || !userId) {\r\n      showSmartFix('Aplicação não pronta ou utilizador não autenticado. Tente novamente.', 'error');\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    setSmartFixMessage(''); // Limpa mensagens anteriores\r\n    try {\r\n      const amount = parseFloat(newSaleAmount);\r\n      // Cria um objeto Date a partir da string selectedSaleDate para o timestamp\r\n      const saleDateTime = new Date(selectedSaleDate + 'T12:00:00'); // Adiciona T12:00:00 para evitar problemas de fuso horário à meia-noite\r\n      const salesCollectionRef = collection(db, `artifacts/${typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'}/users/${userId}/dailySales`);\r\n\r\n      await addDoc(salesCollectionRef, {\r\n        amount: amount,\r\n        timestamp: Timestamp.fromDate(saleDateTime), // Armazena como Timestamp do Firestore\r\n        date: selectedSaleDate // Armazena a data como string AAAA-MM-DD\r\n      });\r\n      setNewSaleAmount('');\r\n      // Atualiza displayDate e viewMode para mostrar o dia da venda recém-adicionada\r\n      setDisplayDate(new Date(selectedSaleDate)); // Define a data de exibição para a data da nova venda\r\n      setDisplayMonth(new Date(selectedSaleDate).getMonth()); // Também atualiza o mês de exibição\r\n      setDisplayYear(new Date(selectedSaleDate).getFullYear()); // Também atualiza o ano de exibição\r\n      setViewMode('daily'); // Garante que a visualização mude para diária para ver a venda específica\r\n\r\n      setSelectedSaleDate(new Date().toISOString().split('T')[0]); // Redefine o seletor de data para a entrada seguinte\r\n      showSmartFix('Venda adicionada com sucesso!', 'success');\r\n      if (saleInputRef.current) {\r\n        saleInputRef.current.focus();\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Erro ao adicionar documento: \", e);\r\n      showSmartFix(\"Erro ao adicionar venda. Por favor, tente novamente.\", 'error');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Função auxiliar para formatar a moeda\r\n  const formatCurrency = (amount) => {\r\n    return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(amount);\r\n  };\r\n\r\n  // Filtra as vendas com base no modo de visualização e navegação\r\n  const getFilteredSales = () => {\r\n    return sales.filter(sale => {\r\n      // Para comparação diária, usa a string 'date' armazenada diretamente para robustez\r\n      // Para outros períodos, converte o timestamp para Date e normaliza\r\n      const saleDate = sale.timestamp ? new Date(sale.timestamp.toDate()) : new Date(sale.date);\r\n      saleDate.setHours(0, 0, 0, 0); // Normaliza a data da venda para o início do dia\r\n\r\n      switch (viewMode) {\r\n        case 'daily':\r\n          // Compara diretamente usando a string AAAA-MM-DD\r\n          const currentDayString = new Date(displayDate).toISOString().split('T')[0];\r\n          return sale.date === currentDayString;\r\n        case 'weekly':\r\n          const startOfWeek = getStartOfWeek(displayDate);\r\n          const endOfWeek = getEndOfWeek(displayDate);\r\n          return saleDate >= startOfWeek && saleDate <= endOfWeek;\r\n        case 'monthly':\r\n          return saleDate.getMonth() === displayMonth && saleDate.getFullYear() === displayYear;\r\n        case 'yearly':\r\n          return saleDate.getFullYear() === displayYear;\r\n        default:\r\n          return true;\r\n      }\r\n    });\r\n  };\r\n\r\n  const filteredSales = getFilteredSales();\r\n  const currentPeriodTotal = filteredSales.reduce((sum, sale) => sum + sale.amount, 0);\r\n\r\n  // Prepara os dados para o gráfico com base no viewMode\r\n  const getChartData = () => {\r\n    const aggregatedData = {};\r\n\r\n    filteredSales.forEach(sale => {\r\n      const saleDate = sale.timestamp ? new Date(sale.timestamp.toDate()) : new Date(sale.date);\r\n      let key; // Chave para agregação (ex: 'AAAA-MM-DD', 'AAAA-Sx', 'AAAA-MM')\r\n      let label; // Rótulo para o eixo X (ex: 'Jan 01', 'Semana 1', 'Janeiro')\r\n\r\n      switch (viewMode) {\r\n        case 'daily':\r\n          key = sale.date; // AAAA-MM-DD\r\n          label = new Date(sale.date).toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' });\r\n          break;\r\n        case 'weekly':\r\n          const weekNumber = getWeekNumber(saleDate);\r\n          key = `${saleDate.getFullYear()}-W${weekNumber}`;\r\n          label = `Semana ${weekNumber}`;\r\n          break;\r\n        case 'monthly':\r\n          // Agrega por número da semana dentro do mês, e cria rótulos de intervalo de datas\r\n          const monthWeekNumber = getWeekNumber(saleDate);\r\n          const startOfPeriodWeek = getStartOfWeek(saleDate);\r\n          const endOfPeriodWeek = getEndOfWeek(saleDate);\r\n\r\n          // Garante que as datas de início/fim da semana estejam dentro do mês de exibição atual\r\n          const monthStart = new Date(displayYear, displayMonth, 1);\r\n          const monthEnd = new Date(displayYear, displayMonth + 1, 0, 23, 59, 59, 999);\r\n\r\n          let displayStart = startOfPeriodWeek;\r\n          let displayEnd = endOfPeriodWeek;\r\n\r\n          // Ajusta o início/fim da semana para estar dentro dos limites do mês\r\n          if (startOfPeriodWeek < monthStart) {\r\n              displayStart = monthStart;\r\n          }\r\n          if (endOfPeriodWeek > monthEnd) {\r\n              displayEnd = monthEnd;\r\n          }\r\n\r\n          key = `${saleDate.getFullYear()}-${saleDate.getMonth() + 1}-W${monthWeekNumber}`;\r\n          label = `${displayStart.toLocaleDateString('pt-BR', { day: '2-digit' })} - ${displayEnd.toLocaleDateString('pt-BR', { day: '2-digit' })}`;\r\n          break;\r\n        case 'yearly':\r\n          const month = saleDate.getMonth();\r\n          const year = saleDate.getFullYear();\r\n          key = `${year}-${month}`; // Agrega por mês\r\n          label = new Date(year, month, 1).toLocaleDateString('pt-BR', { month: 'long' });\r\n          break;\r\n        default:\r\n          key = sale.date;\r\n          label = sale.date;\r\n      }\r\n\r\n      if (aggregatedData[key]) {\r\n        aggregatedData[key].total += sale.amount;\r\n      } else {\r\n        aggregatedData[key] = {\r\n          key: key, // Armazena a chave para ordenação\r\n          label: label,\r\n          total: sale.amount,\r\n          date: saleDate // Armazena a data original para ordenação em visualizações anuais/semanais\r\n        };\r\n      }\r\n    });\r\n\r\n    // Converte para array e ordena\r\n    const data = Object.values(aggregatedData).sort((a, b) => {\r\n      // Ordena com base no objeto Date real, se disponível, caso contrário pela chave\r\n      if (a.date && b.date) {\r\n        return a.date - b.date;\r\n      }\r\n      return a.key.localeCompare(b.key);\r\n    });\r\n\r\n    return data;\r\n  };\r\n\r\n  const chartData = getChartData();\r\n\r\n  // Componente de Rótulo Personalizado para os picos do AreaChart\r\n  const CustomLabel = (props) => {\r\n    const { x, y, stroke, value } = props;\r\n    // Apenas exibe o rótulo se o valor não for zero para evitar desordem em períodos vazios\r\n    // dy = -8 move o rótulo ligeiramente acima do ponto.\r\n    // fill é a cor do texto do rótulo.\r\n    // textAnchor=\"middle\" centraliza o texto.\r\n    if (value > 0) {\r\n      return (\r\n        <text x={x} y={y} dy={-8} fill=\"#20B2AA\" fontSize={12} textAnchor=\"middle\" fontWeight=\"bold\">\r\n          {formatCurrency(value)}\r\n        </text>\r\n      );\r\n    }\r\n    return null;\r\n  };\r\n\r\n\r\n  // Lida com a navegação para diferentes períodos\r\n  const handleNavigate = (direction) => {\r\n    let newDate = new Date(displayDate);\r\n    let newMonth = displayMonth;\r\n    let newYear = displayYear;\r\n\r\n    switch (viewMode) {\r\n      case 'daily':\r\n        newDate.setDate(displayDate.getDate() + direction);\r\n        setDisplayDate(newDate);\r\n        break;\r\n      case 'weekly':\r\n        newDate.setDate(displayDate.getDate() + (direction * 7)); // Move por 7 dias para uma semana\r\n        setDisplayDate(newDate);\r\n        setDisplayWeek(getWeekNumber(newDate));\r\n        break;\r\n      case 'monthly':\r\n        newMonth += direction;\r\n        if (newMonth > 11) {\r\n          newMonth = 0;\r\n          newYear++;\r\n        } else if (newMonth < 0) {\r\n          newMonth = 11;\r\n          newYear--;\r\n        }\r\n        setDisplayMonth(newMonth);\r\n        setDisplayYear(newYear);\r\n        // Ajusta displayDate para estar dentro do novo mês para consistência\r\n        setDisplayDate(new Date(newYear, newMonth, 1));\r\n        break;\r\n      case 'yearly':\r\n        newYear += direction;\r\n        setDisplayYear(newYear);\r\n        // Ajusta displayDate para estar dentro do novo ano para consistência\r\n        setDisplayDate(new Date(newYear, 0, 1));\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  };\r\n\r\n  // Formata a string do período para exibição\r\n  const formatDisplayPeriod = () => {\r\n    const options = { year: 'numeric', month: 'long', day: 'numeric' };\r\n    const date = new Date(displayDate); // Usa displayDate para o contexto de exibição diária/semanal\r\n    date.setFullYear(displayYear, displayMonth, 1); // Para o contexto mensal/anual\r\n\r\n    switch (viewMode) {\r\n      case 'daily':\r\n        return `Dia: ${new Date(displayDate).toLocaleDateString('pt-BR', options)}`;\r\n      case 'weekly':\r\n        const startOfWeek = getStartOfWeek(displayDate).toLocaleDateString('pt-BR');\r\n        const endOfWeek = getEndOfWeek(displayDate).toLocaleDateString('pt-BR');\r\n        return `Semana: ${startOfWeek} - ${endOfWeek} (Semana ${getWeekNumber(displayDate)})`;\r\n      case 'monthly':\r\n        return `Mês: ${new Date(displayYear, displayMonth, 1).toLocaleDateString('pt-BR', { year: 'numeric', month: 'long' })}`;\r\n      case 'yearly':\r\n        return `Ano: ${displayYear}`;\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center p-4 font-sans text-gray-800\">\r\n      <SmartFix message={smartFixMessage} type={smartFixType} onClose={() => setSmartFixMessage('')} />\r\n\r\n      <div className=\"bg-white p-8 rounded-xl shadow-2xl w-full max-w-4xl backdrop-filter backdrop-blur-sm bg-opacity-90 border border-purple-300\">\r\n        <h1 className=\"text-4xl font-extrabold text-center text-purple-800 mb-8 tracking-tight\">\r\n          💸 Minhas Vendas 💸\r\n        </h1>\r\n\r\n        {loading ? (\r\n          <div className=\"flex justify-center items-center h-32\">\r\n            <div className=\"animate-spin rounded-full h-16 w-16 border-b-4 border-purple-500\"></div>\r\n            <p className=\"ml-4 text-purple-700 text-lg\">A carregar dados...</p>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {showInstallMessage && (\r\n              <div className=\"bg-yellow-100 border border-yellow-400 text-yellow-800 px-4 py-3 rounded relative mb-4 flex items-center justify-between\" role=\"alert\">\r\n                <span>Quer instalar esta aplicação para acesso rápido?</span>\r\n                <button\r\n                  onClick={handleInstallClick}\r\n                  className=\"ml-4 bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 active:scale-95\"\r\n                >\r\n                  Instalar Aplicação\r\n                </button>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"mb-8 p-6 bg-purple-50 rounded-lg shadow-inner border border-purple-200\">\r\n              <h2 className=\"text-2xl font-bold text-purple-700 mb-4 flex items-center\">\r\n                <svg className=\"w-6 h-6 mr-2 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.592 1M12 8V7m0 1v8m0 4v1m-6-10H4m4-2H6m7 0h4m-4 2h2M6 20H4m2-2h2m0-6h2m-2 4h2m-2-6h-2m2 0H8m6 0h2m-2 2h2m-2 0H8\"></path></svg>\r\n                Registar Nova Venda\r\n              </h2>\r\n              <div className=\"flex flex-col sm:flex-row gap-4 mb-4\">\r\n                <input\r\n                  ref={saleInputRef}\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  className=\"flex-grow p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-500 focus:border-transparent text-lg shadow-sm\"\r\n                  placeholder=\"Ex: 50.75\"\r\n                  value={newSaleAmount}\r\n                  onChange={(e) => setNewSaleAmount(e.target.value)}\r\n                  onKeyPress={(e) => {\r\n                    if (e.key === 'Enter') {\r\n                      handleAddSale();\r\n                    }\r\n                  }}\r\n                />\r\n                 <input\r\n                    type=\"date\"\r\n                    className=\"p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-500 focus:border-transparent text-lg shadow-sm\"\r\n                    value={selectedSaleDate}\r\n                    onChange={(e) => setSelectedSaleDate(e.target.value)}\r\n                />\r\n              </div>\r\n              <button\r\n                onClick={handleAddSale}\r\n                className=\"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105 active:scale-95 flex items-center justify-center text-lg\"\r\n              >\r\n                <svg className=\"w-5 h-5 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z\"></path></svg>\r\n                Adicionar Venda\r\n              </button>\r\n            </div>\r\n\r\n            {/* Seletor de Modo de Visualização */}\r\n            <div className=\"mb-6 flex justify-center space-x-4\">\r\n              <button\r\n                onClick={() => {\r\n                  setViewMode('daily');\r\n                  setDisplayDate(new Date()); // Redefine para hoje\r\n                }}\r\n                className={`py-2 px-5 rounded-lg font-semibold transition duration-200 ${viewMode === 'daily' ? 'bg-purple-700 text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}\r\n              >\r\n                Dia\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  setViewMode('weekly');\r\n                  setDisplayDate(new Date()); // Redefine para a semana atual\r\n                }}\r\n                className={`py-2 px-5 rounded-lg font-semibold transition duration-200 ${viewMode === 'weekly' ? 'bg-purple-700 text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}\r\n              >\r\n                Semana\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  setViewMode('monthly');\r\n                  setDisplayMonth(new Date().getMonth()); // Redefine para o mês atual\r\n                  setDisplayYear(new Date().getFullYear()); // Redefine para o ano atual\r\n                }}\r\n                className={`py-2 px-5 rounded-lg font-semibold transition duration-200 ${viewMode === 'monthly' ? 'bg-purple-700 text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}\r\n              >\r\n                Mês\r\n              </button>\r\n              <button\r\n                onClick={() => {\r\n                  setViewMode('yearly');\r\n                  setDisplayYear(new Date().getFullYear()); // Redefine para o ano atual\r\n                }}\r\n                className={`py-2 px-5 rounded-lg font-semibold transition duration-200 ${viewMode === 'yearly' ? 'bg-purple-700 text-white shadow-md' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}\r\n              >\r\n                Ano\r\n              </button>\r\n            </div>\r\n\r\n            {/* Navegação por períodos */}\r\n            <div className=\"mb-8 flex items-center justify-between p-4 bg-purple-100 rounded-lg shadow-inner border border-purple-200\">\r\n              <button\r\n                onClick={() => handleNavigate(-1)}\r\n                className=\"p-2 rounded-full bg-purple-300 text-purple-800 hover:bg-purple-400 transition duration-200\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M15 19l-7-7 7-7\"></path></svg>\r\n              </button>\r\n              <h2 className=\"text-xl font-bold text-purple-800 text-center flex-grow\">\r\n                Vendas de: {formatDisplayPeriod()}\r\n              </h2>\r\n              <button\r\n                onClick={() => handleNavigate(1)}\r\n                className=\"p-2 rounded-full bg-purple-300 text-purple-800 hover:bg-purple-400 transition duration-200\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 5l7 7-7 7\"></path></svg>\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"bg-purple-100 p-6 rounded-xl shadow-lg border border-purple-300 mb-8\">\r\n              <h2 className=\"text-xl font-semibold text-purple-700 mb-3 flex items-center\">\r\n                <svg className=\"w-5 h-5 mr-2 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M11 4a2 2 0 114 0v12a4 4 0 11-8 0V4a2 2 0 114 0v12a4 4 0 11-8 0\"></path></svg>\r\n                Total do Período\r\n              </h2>\r\n              <p className=\"text-4xl font-bold text-purple-900\">\r\n                {formatCurrency(currentPeriodTotal)}\r\n              </p>\r\n            </div>\r\n\r\n            {/* Gráfico de Vendas (Gráfico de Área) */}\r\n            <div className=\"bg-white p-6 rounded-xl shadow-lg border border-purple-300 mb-8\">\r\n                <h2 className=\"text-2xl font-bold text-purple-700 mb-4 flex items-center\">\r\n                    <svg className=\"w-6 h-6 mr-2 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M7 12l3-3 3 3 4-4M18 14H5a2 2 0 00-2 2v2a2 2 0 002 2h14a2 2 0 002-2v-2a2 2 0 00-2-2z\"></path></svg>\r\n                    Análise Visual de Vendas\r\n                </h2>\r\n                {chartData.length > 0 ? (\r\n                    <ResponsiveContainer width=\"100%\" height={300}>\r\n                        <AreaChart data={chartData} margin={{ top: 30, right: 30, left: 20, bottom: 5 }}> {/* Margem superior aumentada */}\r\n                            <defs>\r\n                                {/* Gradiente para vendas reais */}\r\n                                <linearGradient id=\"colorTotal\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                    <stop offset=\"5%\" stopColor=\"#20B2AA\" stopOpacity={0.8}/> {/* Azul-petróleo claro */}\r\n                                    <stop offset=\"95%\" stopColor=\"#20B2AA\" stopOpacity={0}/>\r\n                                </linearGradient>\r\n                            </defs>\r\n                            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e0e0e0\"/>\r\n                            <XAxis\r\n                                dataKey=\"label\" // Usa 'label' para exibição do eixo X\r\n                                style={{ fontSize: '0.75rem' }} // Fonte menor para rótulos\r\n                            />\r\n                            <YAxis tickFormatter={(tick) => formatCurrency(tick)} style={{ fontSize: '0.75rem' }}/>\r\n                            <Tooltip\r\n                                formatter={(value, name) => `${name}: ${formatCurrency(value)}`} // Formata o valor e mostra o nome da série\r\n                                labelFormatter={(label, payload) => {\r\n                                  // Encontra o ponto de dados correspondente para obter a data/período real\r\n                                  const dataPoint = payload[0]?.payload;\r\n                                  if (!dataPoint) return label;\r\n\r\n                                  switch (viewMode) {\r\n                                    case 'daily':\r\n                                      return `Vendas em ${new Date(dataPoint.key).toLocaleDateString('pt-BR', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' })}`;\r\n                                    case 'weekly':\r\n                                      return `Vendas da ${dataPoint.label} de ${new Date(dataPoint.date).getFullYear()}`;\r\n                                    case 'monthly':\r\n                                      // Rótulo da dica de ferramenta ajustado para a visualização mensal para mostrar informações da semana\r\n                                      const weekStartDate = getStartOfWeek(new Date(dataPoint.date)); // Usa dataPoint.date\r\n                                      const weekEndDate = getEndOfWeek(new Date(dataPoint.date)); // Usa dataPoint.date\r\n                                      return `Vendas da ${dataPoint.label} (${weekStartDate.toLocaleDateString('pt-BR')} - ${weekEndDate.toLocaleDateString('pt-BR')}) de ${new Date(displayYear, displayMonth, 1).toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}`;\r\n                                    case 'yearly':\r\n                                      return `Vendas de ${dataPoint.label} de ${dataPoint.key.split('-')[0]}`;\r\n                                    default:\r\n                                      return label;\r\n                                  }\r\n                                }}\r\n                            />\r\n                            <Legend />\r\n                            <Area\r\n                              type=\"monotone\"\r\n                              dataKey=\"total\" // Vendas reais\r\n                              stroke=\"#20B2AA\" // Traço mais claro para vendas reais\r\n                              fillOpacity={1}\r\n                              fill=\"url(#colorTotal)\"\r\n                              activeDot={{ r: 8 }}\r\n                              name={\r\n                                viewMode === 'monthly' ? 'Vendas Semanais no Mês' : 'Vendas Mensais no Ano' // Nome dinâmico com base no viewMode\r\n                              }\r\n                            >\r\n                                <LabelList dataKey=\"total\" content={<CustomLabel />} /> {/* Adiciona o componente LabelList */}\r\n                            </Area>\r\n                        </AreaChart>\r\n                    </ResponsiveContainer>\r\n                ) : (\r\n                    <p className=\"text-purple-600 italic text-center\">Adicione vendas para visualizar o gráfico.</p>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"bg-white p-6 rounded-xl shadow-lg border border-purple-300\">\r\n              <h2 className=\"text-2xl font-bold text-purple-700 mb-4 flex items-center\">\r\n                <svg className=\"w-6 h-6 mr-2 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01\"></path></svg>\r\n                Vendas Detalhadas\r\n              </h2>\r\n              {filteredSales.length > 0 ? (\r\n                <ul className=\"divide-y divide-purple-200\">\r\n                  {filteredSales.map(sale => (\r\n                    <li key={sale.id} className=\"py-3 flex justify-between items-center text-purple-800\">\r\n                      <span className=\"text-lg\">\r\n                        {sale.timestamp ? new Date(sale.timestamp.toDate()).toLocaleString('pt-BR') : 'Data Indisponível'}\r\n                      </span>\r\n                      <span className=\"font-semibold text-xl\">{formatCurrency(sale.amount)}</span>\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              ) : (\r\n                <p className=\"text-purple-600 italic\">Nenhuma venda registada para este período.</p>\r\n              )}\r\n            </div>\r\n            {userId && (\r\n              <p className=\"text-xs text-center text-gray-500 mt-6\">\r\n                ID do Utilizador: {userId}\r\n              </p>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}